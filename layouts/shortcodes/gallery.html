<style>
    /* Gallery Grid */
    .image-gallery {
        overflow: auto; 
        margin-left: -1%!important;
    }
    .image-gallery li {
        float: left; 
        display: block; 
        margin: 0 0 1% 1%; 
        width: 32%;
    }
    .image-gallery li a {
        text-align: center; 
        text-decoration: none!important; 
        color: #333;
    }
    .image-gallery li a span {
        display: block; 
        text-overflow: ellipsis; 
        overflow: hidden; 
        white-space: nowrap; 
        padding: 3px 0;
    }
    .image-gallery li a img {
        margin: 0 auto; /* To keep images center */
        width: 40%; 
        display: block;
        border-radius: 8px;
    }

    /* Simple Lightbox */
    .simple-lightbox {
        display: none;
        position: fixed;
        z-index: 999;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #58585871;
    }
    
    .simple-lightbox.active {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .lightbox-content {
        font-size: 2rem;
        position: relative;
        max-width: 90%;
        max-height: 90vh;
    }
    
    .lightbox-content img {
        max-width: 50vh;
        max-height: 50vh;
        object-fit: contain;
    }
    
    .lightbox-caption {
        position: absolute;
        bottom: -40px;
        left: 0;
        right: 0;
        color: black;
        text-align: center;
        padding: 10px;
    }
    
    .lightbox-close {
        position: absolute;
        top: 30px;
        right: 30px;
        color: black;
        font-size: 3rem;
        cursor: pointer;
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
    }
    
    .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: black;
        font-size: 3rem;
        cursor: pointer;
        padding: 5px;
        user-select: none;
    }
    
    .lightbox-prev {
        left: 20px;
    }
    
    .lightbox-next {
        right: 20px;
    }

    @media (prefers-color-scheme: dark) {
        .image-gallery li a {
            text-align: center; 
            text-decoration: none!important; 
            color: #ddd;
        }

        .simple-lightbox {
            display: none;
            position: fixed;
            z-index: 999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff64;
        }
    }
</style>

{{ $dir := .Get "dir" }}
<div class="simple-lightbox">
    <div class="lightbox-content">
        <img src="" alt="">
        <div class="lightbox-caption"></div>
    </div>
    <div class="lightbox-close">&times;</div>
    <div class="lightbox-nav lightbox-prev">&lt;</div>
    <div class="lightbox-nav lightbox-next">&gt;</div>
</div>

<ul class="image-gallery">
{{ range (readDir (print "static" $dir)) }}
    {{- $ext := path.Ext .Name -}}
    {{- if in (slice ".jpg" ".jpeg" ".png" ".gif" ".webp") $ext -}}
        {{- $imagetitle := index (split .Name ".") 0 -}}
        <li>
            <a href="{{ $dir }}/{{ .Name }}" title="{{ $imagetitle }}" class="gallery-image">
                <img src="{{ $dir }}/{{ .Name }}" alt="{{ $imagetitle }}" title="{{ $imagetitle }}">
                <span>{{ $imagetitle }}</span>
            </a>
        </li>
    {{ end }}
{{ end }}
</ul>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const lightbox = document.querySelector('.simple-lightbox');
    const lightboxImg = lightbox.querySelector('img');
    const lightboxCaption = lightbox.querySelector('.lightbox-caption');
    const gallery = document.querySelector('.image-gallery');
    let currentIndex = 0;
    let images = [];

    // collect all images
    gallery.querySelectorAll('.gallery-image').forEach((link, index) => {
        images.push({
            src: link.href,
            title: link.title
        });

        // click event for each image
        link.addEventListener('click', (e) => {
            e.preventDefault();
            currentIndex = index;
            showImage(currentIndex);
        });
    });

    // show image in lightbox
    function showImage(index) {
        lightboxImg.src = images[index].src;
        lightboxCaption.textContent = images[index].title;
        lightbox.classList.add('active');
    }

    // close button
    lightbox.querySelector('.lightbox-close').addEventListener('click', () => {
        lightbox.classList.remove('active');
    });

    // navigation
    lightbox.querySelector('.lightbox-prev').addEventListener('click', () => {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        showImage(currentIndex);
    });

    lightbox.querySelector('.lightbox-next').addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % images.length;
        showImage(currentIndex);
    });

    // keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (!lightbox.classList.contains('active')) return;
        
        if (e.key === 'Escape') {
            lightbox.classList.remove('active');
        } else if (e.key === 'ArrowLeft') {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            showImage(currentIndex);
        } else if (e.key === 'ArrowRight') {
            currentIndex = (currentIndex + 1) % images.length;
            showImage(currentIndex);
        }
    });

    // click anywhere to close lightbox
    lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) {
            lightbox.classList.remove('active');
        }
    });
});
</script>